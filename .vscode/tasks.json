{
	"version": "2.0.0",
	"tasks": [
		{
			"label": "debug:env-check",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && echo \"SESSION_SECRET:\" && (grep -n '^SESSION_SECRET=' .env | sed 's/=.*$/=(set)/' || echo \"(missing)\") && echo \"DB_SSL_REJECT_UNAUTHORIZED:\" && (grep -n '^DB_SSL_REJECT_UNAUTHORIZED=' .env | sed 's/=.*$/=(set)/' || echo \"(missing)\") && echo \"POSTGRES_URL:\" && (grep -n '^POSTGRES_URL=' .env | head -n 1 | sed 's/=.*$/=(set)/' || echo \"(missing)\")"
		},
		{
			"label": "dev:next",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && npm run dev -- --port 3000",
			"isBackground": true
		},
		{
			"label": "debug:auth-smoke",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && email=\"test$(date +%s)@example.com\" && pass=\"Passw0rd!\" && export EMAIL=\"$email\" PASS=\"$pass\" && register_payload=$(node -e \"console.log(JSON.stringify({firstName:'Test',lastName:'User',email:process.env.EMAIL,password:process.env.PASS}))\") && login_payload=$(node -e \"console.log(JSON.stringify({email:process.env.EMAIL,password:process.env.PASS}))\") && echo \"Registering $email\" && curl -s -i -X POST http://localhost:3000/api/auth/register -H \"content-type: application/json\" --data \"$register_payload\" | sed -n '1,35p' && echo \"---\" && echo \"Logging in $email\" && curl -s -i -X POST http://localhost:3000/api/auth/login -H \"content-type: application/json\" --data \"$login_payload\" | sed -n '1,35p'"
		},
		{
			"label": "debug:auth-with-logs",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && (lsof -ti tcp:3000 | xargs -r kill -9) && rm -f /tmp/next-dev.log && (npm run dev -- --port 3000 > /tmp/next-dev.log 2>&1 &) && sleep 2 && email=\"test$(date +%s)@example.com\" && pass=\"Passw0rd!\" && export EMAIL=\"$email\" PASS=\"$pass\" && register_payload=$(node -e \"console.log(JSON.stringify({firstName:'Test',lastName:'User',email:process.env.EMAIL,password:process.env.PASS}))\") && echo \"Registering $email\" && curl -s -i -X POST http://localhost:3000/api/auth/register -H \"content-type: application/json\" --data \"$register_payload\" | sed -n '1,40p' && echo \"--- DEV LOG (tail) ---\" && tail -n 120 /tmp/next-dev.log | sed -n '1,120p'"
		},
		{
			"label": "debug:auth-with-logs-2",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && (lsof -ti tcp:3000 | xargs -r kill -9) && rm -f /tmp/next-dev.log && (npm run dev -- --port 3000 > /tmp/next-dev.log 2>&1 &) && sleep 4 && echo \"Health:\" && (curl -sS -I http://localhost:3000/ | head -n 5 || true) && email=\"test$(date +%s)@example.com\" && pass=\"Passw0rd!\" && export EMAIL=\"$email\" PASS=\"$pass\" && register_payload=$(node -e \"console.log(JSON.stringify({firstName:'Test',lastName:'User',email:process.env.EMAIL,password:process.env.PASS}))\") && echo \"Registering $email\" && (curl -sS -i -X POST http://localhost:3000/api/auth/register -H \"content-type: application/json\" --data \"$register_payload\" | sed -n '1,60p' || true) && echo \"--- DEV LOG (tail) ---\" && tail -n 200 /tmp/next-dev.log | sed -n '1,200p'"
		},
		{
			"label": "debug:db-check",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && node -e \"(async () => { const pg = require('pg'); const url = process.env.DATABASE_URL || process.env.POSTGRES_URL || process.env.POSTGRES_PRISMA_URL || process.env.POSTGRES_URL_NON_POOLING; if (!url) { console.error('No DB url env set'); process.exit(2); } const raw = process.env.DB_SSL_REJECT_UNAUTHORIZED || process.env.PGSSL_REJECT_UNAUTHORIZED; const rejectUnauthorized = raw == null ? true : !['0','false','no'].includes(String(raw).toLowerCase()); const pool = new pg.Pool({ connectionString: url, ssl: { rejectUnauthorized } }); const one = await pool.query('select 1 as ok'); const reg = await pool.query(\\\"select to_regclass('public.users') as users, to_regclass('public.members') as members, to_regclass('public.transactions') as transactions\\\"); console.log('DB_OK', one.rows[0].ok); console.log('TABLES', reg.rows[0]); await pool.end(); })().catch((e) => { console.error('DB_CHECK_FAILED', e && e.message ? e.message : e); process.exit(1); });\""
		},
		{
			"label": "debug:db-check-dotenv",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && DOTENV_CONFIG_PATH=.env node -r dotenv/config -e \"(async () => { const pg = require('pg'); const url = process.env.DATABASE_URL || process.env.POSTGRES_URL || process.env.POSTGRES_PRISMA_URL || process.env.POSTGRES_URL_NON_POOLING; if (!url) { console.error('No DB url env set'); process.exit(2); } const raw = process.env.DB_SSL_REJECT_UNAUTHORIZED || process.env.PGSSL_REJECT_UNAUTHORIZED; const rejectUnauthorized = raw == null ? true : !['0','false','no'].includes(String(raw).toLowerCase()); const pool = new pg.Pool({ connectionString: url, ssl: { rejectUnauthorized } }); const one = await pool.query('select 1 as ok'); const reg = await pool.query(\\\"select to_regclass('public.users') as users, to_regclass('public.members') as members, to_regclass('public.transactions') as transactions\\\"); console.log('DB_OK', one.rows[0].ok); console.log('TABLES', reg.rows[0]); await pool.end(); })().catch((e) => { console.error('DB_CHECK_FAILED', e && e.message ? e.message : e); process.exit(1); });\""
		},
		{
			"label": "debug:db-check-run",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && DOTENV_CONFIG_PATH=.env node -r dotenv/config script/db-check.mjs"
		},
		{
			"label": "debug:show-db-ssl",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && grep -n '^DB_SSL_REJECT_UNAUTHORIZED=' .env || true"
		},
		{
			"label": "debug:db-check-run-2",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && DOTENV_CONFIG_PATH=.env node -r dotenv/config script/db-check.mjs"
		},
		{
			"label": "debug:db-check-run-3",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && DOTENV_CONFIG_PATH=.env node -r dotenv/config script/db-check.mjs"
		},
		{
			"label": "debug:db-check-run-4",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && DOTENV_CONFIG_PATH=.env node -r dotenv/config script/db-check.mjs"
		},
		{
			"label": "db:push (local no-verify)",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && NODE_TLS_REJECT_UNAUTHORIZED=0 npm run db:push"
		},
		{
			"label": "debug:db-check-after-push",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && DOTENV_CONFIG_PATH=.env node -r dotenv/config script/db-check.mjs"
		},
		{
			"label": "debug:auth-smoke-2",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && (lsof -ti tcp:3000 | xargs -r kill -9) && rm -f /tmp/next-dev.log && (npm run dev -- --port 3000 > /tmp/next-dev.log 2>&1 &) && for i in {1..30}; do curl -sS -I http://localhost:3000/ >/dev/null && break; sleep 0.5; done && echo \"Health:\" && curl -sS -I http://localhost:3000/ | head -n 5 && email=\"test$(date +%s)@example.com\" && pass=\"Passw0rd!\" && export EMAIL=\"$email\" PASS=\"$pass\" && register_payload=$(node -e \"console.log(JSON.stringify({firstName:'Test',lastName:'User',email:process.env.EMAIL,password:process.env.PASS}))\") && login_payload=$(node -e \"console.log(JSON.stringify({email:process.env.EMAIL,password:process.env.PASS}))\") && echo \"--- Register ($email) ---\" && curl -sS -i -X POST http://localhost:3000/api/auth/register -H \"content-type: application/json\" --data \"$register_payload\" | sed -n '1,25p' && echo \"--- Login ($email) ---\" && curl -sS -i -X POST http://localhost:3000/api/auth/login -H \"content-type: application/json\" --data \"$login_payload\" | sed -n '1,25p' && echo \"--- Dev log tail ---\" && tail -n 40 /tmp/next-dev.log"
		},
		{
			"label": "debug:tail-next-dev-log",
			"type": "shell",
			"command": "tail -n 200 /tmp/next-dev.log 2>/dev/null || echo \"(no /tmp/next-dev.log)\""
		},
		{
			"label": "tsc-check",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && npm run check"
		},
		{
			"label": "tsc-check-2",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && ./node_modules/.bin/tsc --noEmit -p tsconfig.json && echo TSC_OK"
		},
		{
			"label": "db:seed",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && NODE_TLS_REJECT_UNAUTHORIZED=0 npm run db:seed"
		},
		{
			"label": "smoke:login-seed-user",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && curl -sS -i -X POST http://localhost:3000/api/auth/login -H 'content-type: application/json' --data '{\"email\":\"seed.member01@jtw.local\",\"password\":\"password\"}' | sed -n '1,25p'"
		},
		{
			"label": "debug:env-presence",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && echo \"POSTGRES_URL:\" && (grep -n '^POSTGRES_URL=' .env | head -n 1 | sed 's/=.*$/=(set)/' || echo '(missing)') && echo \"DATABASE_URL:\" && (grep -n '^DATABASE_URL=' .env | head -n 1 | sed 's/=.*$/=(set)/' || echo '(missing)') && echo \"SESSION_SECRET:\" && (grep -n '^SESSION_SECRET=' .env | head -n 1 | sed 's/=.*$/=(set)/' || echo '(missing)')"
		},
		{
			"label": "tsc",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && ./node_modules/.bin/tsc --noEmit -p tsconfig.json"
		},
		{
			"label": "dev:next (3000)",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && npm run dev -- --port 3000",
			"isBackground": true
		},
		{
			"label": "smoke:login-seed-member01",
			"type": "shell",
			"command": "cd /Users/macbookpro/Desktop/projects/Church-Manager && for i in {1..30}; do curl -sS -I http://localhost:3000/ >/dev/null && break; sleep 0.5; done && curl -sS -i -X POST http://localhost:3000/api/auth/login -H 'content-type: application/json' --data '{\"email\":\"seed.member01@jtw.local\",\"password\":\"password\"}' | sed -n '1,25p'"
		}
	]
}